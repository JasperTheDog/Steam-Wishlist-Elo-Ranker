<!doctype html>
<html>
<head>
<link rel="stylesheet" href="/theme.css">
<meta charset="utf-8" />
<title>Wishlist Elo — History</title>
<style>
body {
  font-family: system-ui, sans-serif;
  margin:0;
  padding:24px;
  background:#f9f9f9;
}
header {
  display:flex;
  justify-content: space-between;
  align-items: center;
  padding:16px 32px;
  background:#fff;
  box-shadow:0 1px 4px rgba(0,0,0,0.08);
  position: sticky;
  top:0;
  z-index:100;
}
header h2 { margin:0; font-size:22px; font-weight:600; }
header a.button {
  padding:8px 18px;
  background:#007bff;
  color:white;
  border-radius:6px;
  text-decoration:none;
  font-weight:500;
  margin-left:8px;
  transition: background 0.2s;
}
header a.button:hover { background:#0056b3; }

.history-container {
  display:flex;
  flex-direction:column;
  gap:16px;
  margin-top:24px;
}

.battle-card {
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:#fff;
  border-radius:8px;
  padding:12px 16px;
  box-shadow:0 1px 6px rgba(0,0,0,0.08);
}

.player {
  display:flex;
  align-items:center;
  gap:12px;
  width:45%;
}

.player.loser {
  justify-content: flex-end;  /* push whole block to right */
}

.player img {
  width:200px;
  height:60px;
  border-radius:6px;
  object-fit:cover;
  flex-shrink:0;
}

.player-info {
  display:flex;
  flex-direction:column;
}

.elo-delta {
  font-weight:600;
  font-size:16px;
}

.elo-delta.green { color:green; }
.elo-delta.red { color:red; }

.elo-oldnew {
  font-size:12px;
  color:#555;
}

.separator {
  width:10%;
  text-align:center;
  font-size:18px;
  font-weight:600;
}
</style>
</head>
<body>

<header>
  <h2>Battle History</h2>
  <div style="display:flex; gap:10px;">
    <a href="/index.html" class="button button-duel">Quick Duel</a>
    <a href="/leaderboard.html" class="button button-leaderboard">Leaderboard</a>
    <a href="/settings.html" class="button button-settings">Settings</a>
  </div>
</header>

<div style="margin: 12px 0 0 0; font-size:13px; color:#856404;">
  <span style="background:#ffe066; color:#856404; font-size:12px; font-weight:600; padding:2px 8px; border-radius:4px;">PASS</span>
  = This result was from a pass (no strong preference)
</div>

<div class="history-container" id="history-container">
  Loading…
</div>

<script>
function eloSymbol(k, delta) {
  // K-only mapping
  if(k === 24) return delta > 0 ? '+' : '-';
  if(k === 48) return delta > 0 ? '++' : '--';
  return delta > 0 ? '+' : '-';
}

async function loadHistory() {
  const res = await fetch('/history');
  if(!res.ok){ alert('Failed to load history'); return; }
  const data = await res.json();
  const container = document.getElementById('history-container');
  container.innerHTML = '';

  if(data.count===0){
    container.innerHTML = '<div style="text-align:center;">No history yet</div>';
    return;
  }

  data.history.forEach(h=>{
    const winnerDelta = Math.round(h.r_w_after - h.r_w_before);
    const loserDelta = Math.round(h.r_l_after - h.r_l_before);

    const isPass = h.pass === true;
    const passBadge = isPass ? `<span style="background:#ffe066; color:#856404; font-size:12px; font-weight:600; padding:2px 8px; border-radius:4px; margin-left:8px;">PASS</span>` : "";
    const separator = isPass
      ? `<div class="separator" style="color:#856404;">⇄</div>`
      : `<div class="separator">←</div>`;

    const card = document.createElement('div');
    card.className = 'battle-card';
    card.innerHTML = `
    <div class="player">
        <a href="/game/${h.winner}" style="display:flex; align-items:center; gap:12px; text-decoration:none; color:inherit;">
        <img src="${h.winner_image}" alt="${h.winner_title}" />
        <div class="player-info">
            <div>${h.winner_title} ${passBadge}</div>
            <div class="elo-delta green">${eloSymbol(h.k, winnerDelta)}${winnerDelta}</div>
            <div class="elo-oldnew">${Math.round(h.r_w_before)} → ${Math.round(h.r_w_after)}</div>
        </div>
        </a>
    </div>
    ${separator}
    <div class="player loser">
        <a href="/game/${h.loser}" style="display:flex; align-items:center; gap:12px; text-decoration:none; color:inherit;">
        <div class="player-info" style="text-align:right;">
            <div>${passBadge} ${h.loser_title}</div>
            <div class="elo-delta red">${eloSymbol(h.k, loserDelta)}${Math.abs(loserDelta)}</div>
            <div class="elo-oldnew">${Math.round(h.r_l_before)} → ${Math.round(h.r_l_after)}</div>
        </div>
        <img src="${h.loser_image}" alt="${h.loser_title}" />
        </a>
    </div>
    `;
    container.appendChild(card);
  });
}

loadHistory();
</script>

</body>
</html>
